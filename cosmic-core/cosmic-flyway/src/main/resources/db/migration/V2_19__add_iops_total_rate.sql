-- Add iops_total_rate column to disk_offering and disk_offering_view
ALTER TABLE `disk_offering`
  ADD COLUMN `iops_total_rate` LONG;

ALTER VIEW `disk_offering_view`
  AS SELECT
       `disk_offering`.`id` AS `id`,
       `disk_offering`.`uuid` AS `uuid`,
       `disk_offering`.`name` AS `name`,
       `disk_offering`.`display_text` AS `display_text`,
       `disk_offering`.`provisioning_type` AS `provisioning_type`,
       `disk_offering`.`disk_size` AS `disk_size`,
       `disk_offering`.`min_iops` AS `min_iops`,
       `disk_offering`.`max_iops` AS `max_iops`,
       `disk_offering`.`created` AS `created`,
       `disk_offering`.`tags` AS `tags`,
       `disk_offering`.`customized` AS `customized`,
       `disk_offering`.`customized_iops` AS `customized_iops`,
       `disk_offering`.`removed` AS `removed`,
       `disk_offering`.`use_local_storage` AS `use_local_storage`,
       `disk_offering`.`system_use` AS `system_use`,
       `disk_offering`.`hv_ss_reserve` AS `hv_ss_reserve`,
       `disk_offering`.`bytes_read_rate` AS `bytes_read_rate`,
       `disk_offering`.`bytes_write_rate` AS `bytes_write_rate`,
       `disk_offering`.`iops_read_rate` AS `iops_read_rate`,
       `disk_offering`.`iops_write_rate` AS `iops_write_rate`,
       `disk_offering`.`iops_total_rate` AS `iops_total_rate`,
       `disk_offering`.`cache_mode` AS `cache_mode`,
       `disk_offering`.`sort_key` AS `sort_key`,
       `disk_offering`.`type` AS `type`,
       `disk_offering`.`display_offering` AS `display_offering`,
       `domain`.`id` AS `domain_id`,
       `domain`.`uuid` AS `domain_uuid`,
       `domain`.`name` AS `domain_name`,
       `domain`.`path` AS `domain_path`
     FROM (`disk_offering` left join `domain` on(`disk_offering`.`domain_id` = `domain`.`id`)) where `disk_offering`.`state` = 'ACTIVE';


ALTER VIEW `volume_view`
AS SELECT
   `volumes`.`id` AS `id`,
   `volumes`.`uuid` AS `uuid`,
   `volumes`.`name` AS `name`,
   `volumes`.`device_id` AS `device_id`,
   `volumes`.`volume_type` AS `volume_type`,
   `volumes`.`provisioning_type` AS `provisioning_type`,
   `volumes`.`size` AS `size`,
   `volumes`.`min_iops` AS `min_iops`,
   `volumes`.`max_iops` AS `max_iops`,
   `volumes`.`created` AS `created`,
   `volumes`.`state` AS `state`,
   `volumes`.`attached` AS `attached`,
   `volumes`.`removed` AS `removed`,
   `volumes`.`pod_id` AS `pod_id`,
   `volumes`.`display_volume` AS `display_volume`,
   `volumes`.`format` AS `format`,
   `volumes`.`path` AS `path`,
   `volumes`.`chain_info` AS `chain_info`,
   `account`.`id` AS `account_id`,
   `account`.`uuid` AS `account_uuid`,
   `account`.`account_name` AS `account_name`,
   `account`.`type` AS `account_type`,
   `domain`.`id` AS `domain_id`,
   `domain`.`uuid` AS `domain_uuid`,
   `domain`.`name` AS `domain_name`,
   `domain`.`path` AS `domain_path`,
   `projects`.`id` AS `project_id`,
   `projects`.`uuid` AS `project_uuid`,
   `projects`.`name` AS `project_name`,
   `data_center`.`id` AS `data_center_id`,
   `data_center`.`uuid` AS `data_center_uuid`,
   `data_center`.`name` AS `data_center_name`,
   `data_center`.`networktype` AS `data_center_type`,
   `vm_instance`.`id` AS `vm_id`,
   `vm_instance`.`uuid` AS `vm_uuid`,
   `vm_instance`.`name` AS `vm_name`,
   `vm_instance`.`state` AS `vm_state`,
   `vm_instance`.`vm_type` AS `vm_type`,
   `user_vm`.`display_name` AS `vm_display_name`,
   `volume_store_ref`.`size` AS `volume_store_size`,
   `volume_store_ref`.`download_pct` AS `download_pct`,
   `volume_store_ref`.`download_state` AS `download_state`,
   `volume_store_ref`.`error_str` AS `error_str`,
   `volume_store_ref`.`created` AS `created_on_store`,
   `disk_offering`.`id` AS `disk_offering_id`,
   `disk_offering`.`uuid` AS `disk_offering_uuid`,
   `disk_offering`.`name` AS `disk_offering_name`,
   `disk_offering`.`display_text` AS `disk_offering_display_text`,
   `disk_offering`.`use_local_storage` AS `use_local_storage`,
   `disk_offering`.`system_use` AS `system_use`,
   `disk_offering`.`bytes_read_rate` AS `bytes_read_rate`,
   `disk_offering`.`bytes_write_rate` AS `bytes_write_rate`,
   `disk_offering`.`iops_read_rate` AS `iops_read_rate`,
   `disk_offering`.`iops_write_rate` AS `iops_write_rate`,
   `disk_offering`.`iops_total_rate` AS `iops_total_rate`,
   `disk_offering`.`cache_mode` AS `cache_mode`,
   `storage_pool`.`id` AS `pool_id`,
   `storage_pool`.`uuid` AS `pool_uuid`,
   `storage_pool`.`name` AS `pool_name`,
   `cluster`.`hypervisor_type` AS `hypervisor_type`,
   `vm_template`.`id` AS `template_id`,
   `vm_template`.`uuid` AS `template_uuid`,
   `vm_template`.`extractable` AS `extractable`,
   `vm_template`.`type` AS `template_type`,
   `vm_template`.`name` AS `template_name`,
   `vm_template`.`display_text` AS `template_display_text`,
   `iso`.`id` AS `iso_id`,
   `iso`.`uuid` AS `iso_uuid`,
   `iso`.`name` AS `iso_name`,
   `iso`.`display_text` AS `iso_display_text`,
   `resource_tags`.`id` AS `tag_id`,
   `resource_tags`.`uuid` AS `tag_uuid`,
   `resource_tags`.`key` AS `tag_key`,
   `resource_tags`.`value` AS `tag_value`,
   `resource_tags`.`domain_id` AS `tag_domain_id`,
   `domain`.`uuid` AS `tag_domain_uuid`,
   `domain`.`name` AS `tag_domain_name`,
   `resource_tags`.`account_id` AS `tag_account_id`,
   `account`.`account_name` AS `tag_account_name`,
   `resource_tags`.`resource_id` AS `tag_resource_id`,
   `resource_tags`.`resource_uuid` AS `tag_resource_uuid`,
   `resource_tags`.`resource_type` AS `tag_resource_type`,
   `resource_tags`.`customer` AS `tag_customer`,
   `async_job`.`id` AS `job_id`,
   `async_job`.`uuid` AS `job_uuid`,
   `async_job`.`job_status` AS `job_status`,
   `async_job`.`account_id` AS `job_account_id`
FROM ((((((((((((((`volumes` join `account` on(`volumes`.`account_id` = `account`.`id`)) join `domain` on(`volumes`.`domain_id` = `domain`.`id`)) left join `projects` on(`projects`.`project_account_id` = `account`.`id`)) left join `data_center` on(`volumes`.`data_center_id` = `data_center`.`id`)) left join `vm_instance` on(`volumes`.`instance_id` = `vm_instance`.`id`)) left join `user_vm` on(`user_vm`.`id` = `vm_instance`.`id`)) left join `volume_store_ref` on(`volumes`.`id` = `volume_store_ref`.`volume_id`)) left join `disk_offering` on(`volumes`.`disk_offering_id` = `disk_offering`.`id`)) left join `storage_pool` on(`volumes`.`pool_id` = `storage_pool`.`id`)) left join `cluster` on(`storage_pool`.`cluster_id` = `cluster`.`id`)) left join `vm_template` on(`volumes`.`template_id` = `vm_template`.`id`)) left join `vm_template` `iso` on(`iso`.`id` = `volumes`.`iso_id`)) left join `resource_tags` on(`resource_tags`.`resource_id` = `volumes`.`id` and `resource_tags`.`resource_type` = 'Volume')) left join `async_job` on(`async_job`.`instance_id` = `volumes`.`id` and `async_job`.`instance_type` = 'Volume' and `async_job`.`job_status` = 0));

ALTER VIEW `service_offering_view`
AS SELECT
   `service_offering`.`id` AS `id`,
   `disk_offering`.`uuid` AS `uuid`,
   `disk_offering`.`name` AS `name`,
   `disk_offering`.`display_text` AS `display_text`,
   `disk_offering`.`provisioning_type` AS `provisioning_type`,
   `disk_offering`.`created` AS `created`,
   `disk_offering`.`tags` AS `tags`,
   `disk_offering`.`removed` AS `removed`,
   `disk_offering`.`use_local_storage` AS `use_local_storage`,
   `disk_offering`.`system_use` AS `system_use`,
   `disk_offering`.`customized_iops` AS `customized_iops`,
   `disk_offering`.`min_iops` AS `min_iops`,
   `disk_offering`.`max_iops` AS `max_iops`,
   `disk_offering`.`hv_ss_reserve` AS `hv_ss_reserve`,
   `disk_offering`.`bytes_read_rate` AS `bytes_read_rate`,
   `disk_offering`.`bytes_write_rate` AS `bytes_write_rate`,
   `disk_offering`.`iops_read_rate` AS `iops_read_rate`,
   `disk_offering`.`iops_write_rate` AS `iops_write_rate`,
   `disk_offering`.`iops_total_rate` AS `iops_total_rate`,
   `disk_offering`.`cache_mode` AS `cache_mode`,
   `service_offering`.`cpu` AS `cpu`,
   `service_offering`.`ram_size` AS `ram_size`,
   `service_offering`.`nw_rate` AS `nw_rate`,
   `service_offering`.`mc_rate` AS `mc_rate`,
   `service_offering`.`ha_enabled` AS `ha_enabled`,
   `service_offering`.`limit_cpu_use` AS `limit_cpu_use`,
   `service_offering`.`host_tag` AS `host_tag`,
   `service_offering`.`default_use` AS `default_use`,
   `service_offering`.`vm_type` AS `vm_type`,
   `service_offering`.`sort_key` AS `sort_key`,
   `service_offering`.`is_volatile` AS `is_volatile`,
   `service_offering`.`deployment_planner` AS `deployment_planner`,
   `domain`.`id` AS `domain_id`,
   `domain`.`uuid` AS `domain_uuid`,
   `domain`.`name` AS `domain_name`,
   `domain`.`path` AS `domain_path`
FROM ((`service_offering` join `disk_offering` on(`service_offering`.`id` = `disk_offering`.`id`)) left join `domain` on(`disk_offering`.`domain_id` = `domain`.`id`)) where `disk_offering`.`state` = 'Active';
